{"version":3,"names":[],"mappings":"","sources":["shatranj-model.js"],"sourcesContent":["\n(function() {\n\t\n\tvar geometry = Model.Game.cbBoardGeometryGrid(8,8);\n\t\n\tModel.Game.cbDefine = function() {\n\t\t\t\t\n\t\tvar elephantGraph = this.cbShortRangeGraph(geometry,[[-2,-2],[-2,2],[2,-2],[2,2]]);\n\n\t\treturn {\n\t\t\t\n\t\t\tgeometry: geometry,\n\t\t\t\n\t\t\tpieceTypes: {\n\n\t\t\t\t0: {\n\t\t\t\t\tname: 'pawn-w',\n\t\t\t\t\taspect: 'np-pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tepCatch: false,\n\t\t\t\t\tinitial: [{s:1,p:8},{s:1,p:9},{s:1,p:10},{s:1,p:11},{s:1,p:12},{s:1,p:13},{s:1,p:14},{s:1,p:15}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t2: {\n\t\t\t\t\tname: 'pawn-b',\n\t\t\t\t\taspect: 'np-pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,-1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:-1,p:48},{s:-1,p:49},{s:-1,p:50},{s:-1,p:51},{s:-1,p:52},{s:-1,p:53},{s:-1,p:54},{s:-1,p:55}],\n\t\t\t\t\tepCatch: false,\n\t\t\t\t},\n\n\t\t\t\t\n\t\t\t\t4: {\n\t\t\t\t\tname: 'knight',\n\t\t\t\t\taspect: 'np-knight',\n\t\t\t\t\tgraph: this.cbKnightGraph(geometry),\n\t\t\t\t\tvalue: 3.5,\n\t\t\t\t\tabbrev: 'N',\n\t\t\t\t\tinitial: [{s:1,p:1},{s:1,p:6},{s:-1,p:57},{s:-1,p:62}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t5: {\n\t\t\t\t\tname: 'elephant',\n\t\t\t\t\taspect: 'np-elephant',\n\t\t\t\t\tgraph: elephantGraph,\n\t\t\t\t\tvalue: 2.5,\n\t\t\t\t\tabbrev: 'E',\n\t\t\t\t\tinitial: [{s:1,p:2},{s:1,p:5},{s:-1,p:58},{s:-1,p:61}],\n\t\t\t\t},\n\n\t\t\t\t6: {\n\t\t\t\t\tname: 'rook',\n\t\t\t\t\taspect: 'np-rook',\n\t\t\t\t\tgraph: this.cbRookGraph(geometry),\n\t\t\t\t\tvalue: 5,\n\t\t\t\t\tabbrev: 'R',\n\t\t\t\t\tinitial: [{s:1,p:0},{s:1,p:7},{s:-1,p:56},{s:-1,p:63}],\n\t\t\t\t\tcastle: false,\n\t\t\t\t},\n\n\t\t\t\t7: {\n\t\t\t\t\tname: 'general',\n\t\t\t\t\taspect: 'np-general',\n\t\t\t\t\tgraph: this.cbFersGraph(geometry),\n\t\t\t\t\tvalue: 2,\n\t\t\t\t\tabbrev: 'G',\n\t\t\t\t\tinitial: [{s:1,p:4},{s:-1,p:60}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t8: {\n\t\t\t\t\tname: 'king',\n\t\t\t\t\taspect: 'np-king',\n\t\t\t\t\tisKing: true,\n\t\t\t\t\tgraph: this.cbKingGraph(geometry),\n\t\t\t\t\tabbrev: 'K',\n\t\t\t\t\tinitial: [{s:1,p:3},{s:-1,p:59}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\tpromote: function(aGame,piece,move) {\n\t\t\t\tif(piece.t==0 && geometry.R(move.t)==7)\n\t\t\t\t\treturn [7];\n\t\t\t\telse if(piece.t==2 && geometry.R(move.t)==0)\n\t\t\t\t\treturn [7];\n\t\t\t\treturn [];\n\t\t\t},\n\n\t\t\t\n\t\t\tevaluate: function(aGame,evalValues,material) {\n\t\t\t\t// check lack of material to checkmate\n\t\t\t\tvar white=material[1].count;\n\t\t\t\tvar black=material[-1].count;\n\t\t\t\tif(!white[0] && !white[1] && !white[4] && !white[5] && !white[6] && !white[7]) { // white king single\n\t\t\t\t\tif(!black[2] && !black[3] && !black[6] && !black[7] && (black[4]+black[5]<2 || black[5]<2)) {\n\t\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\t\tthis.mWinner=JocGame.PLAYER_B;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!black[2] && !black[3] && !black[4] && !black[5] && !black[6] && !black[7]) { // black king single\n\t\t\t\t\tif(!white[0] && !white[1] && !white[6] && !white[7] && (white[4]+white[5]<2 || white[5]<2)) {\n\t\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\t\tthis.mWinner=JocGame.PLAYER_A;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// check 50 moves without capture\n\t\t\t\tif(this.noCaptCount>=100) {\n\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\tthis.mWinner=JocGame.DRAW;\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// motivate pawns to reach the promotion line\n\t\t\t\tvar distPromo=aGame.cbUseTypedArrays?new Int8Array(3):[0,0,0];\n\t\t\t\tvar height=geometry.height;\n\t\t\t\tvar pawns=material[1].byType[0],pawnsLength;\n\t\t\t\tif(pawns) {\n\t\t\t\t\tpawnsLength=pawns.length;\n\t\t\t\t\tfor(var i=0;i<pawnsLength;i++)\n\t\t\t\t\t\tswitch(height-geometry.R(pawns[i].p)) {\n\t\t\t\t\t\tcase 2: distPromo[0]++; break;\n\t\t\t\t\t\tcase 3: distPromo[1]++; break;\n\t\t\t\t\t\tcase 4: distPromo[2]++; break;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpawns=material[-1].byType[2],pawnsLength;\n\t\t\t\tif(pawns) {\n\t\t\t\t\tpawnsLength=pawns.length;\n\t\t\t\t\tfor(var i=0;i<pawnsLength;i++)\n\t\t\t\t\t\tswitch(geometry.R(pawns[i].p)) {\n\t\t\t\t\t\tcase 1: distPromo[0]--; break;\n\t\t\t\t\t\tcase 2: distPromo[1]--; break;\n\t\t\t\t\t\tcase 3: distPromo[2]--; break;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(distPromo[0]!=0)\n\t\t\t\t\tevalValues['distPawnPromo1']=distPromo[0];\n\t\t\t\tif(distPromo[1]!=0)\n\t\t\t\t\tevalValues['distPawnPromo2']=distPromo[1];\n\t\t\t\tif(distPromo[2]!=0)\n\t\t\t\t\tevalValues['distPawnPromo3']=distPromo[2];\n\t\t\t\t\n\t\t\t\t// motivate knights and bishops to deploy early\n\t\t\t\tvar minorPiecesMoved=0;\n\t\t\t\tfor(var t=4;t<=5;t++)\n\t\t\t\t\tfor(var s=1;s>=-1;s-=2) {\n\t\t\t\t\t\tvar pieces=material[s].byType[t];\n\t\t\t\t\t\tif(pieces)\n\t\t\t\t\t\t\tfor(var i=0;i<pieces.length;i++)\n\t\t\t\t\t\t\t\tif(pieces[i].m)\n\t\t\t\t\t\t\t\t\tminorPiecesMoved+=s;\n\t\t\t\t\t}\n\t\t\t\tif(minorPiecesMoved!=0) {\n\t\t\t\t\tevalValues['minorPiecesMoved']=minorPiecesMoved;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t};\n\t}\n\t\n})();"],"file":"shatranj-chess-model.js"}