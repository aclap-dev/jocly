exports.model=Model={Game:{},Board:{},Move:{}},function(){function t(t){if(o){var e=t%s;return(t-e)/s*s+s-e}var r=s*i-t-1,n=r%s;return r-n+s-n}var s,i,o=!1;Model.Game.checkersPosToString=t,Model.Game.InitGameInfo=function(){},Model.Game.BuildGraphCoord=function(){var t=(this.mOptions.width,this.mOptions.height,[]),s=[];this.g.Graph=t,this.g.Coord=s},Model.Game.InitGame=function(){var t=this.mOptions.width,e=this.mOptions.height;if(s=t,i=e,o=this.mOptions.invertNotation||!1,this.g.compulsoryCatch=!0,this.g.canStepBack=!0,this.g.mustMoveForward=!1,this.g.mustMoveForwardStrict=!1,this.g.lastRowFreeze=!1,this.g.lastRowCrown=!1,this.g.captureLongestLine=!1,this.g.noMove="lose",this.g.kingCaptureShort=!1,this.g.kingValue=5,this.g.lastRowFactor=0,this.g.canCaptureBackward=!0,this.g.captureInstantRemove=!1,this.g.longRangeKing=!0,this.g.drawKvsK=!0,this.g.drawKvs2K=!0,this.g.whiteStarts=!0,this.g.king180deg=!1,this.mOptions.variant)for(var r in this.mOptions.variant)this.mOptions.variant.hasOwnProperty(r)&&(this.g[r]=this.mOptions.variant[r]);this.BuildGraphCoord(),this.zobrist=new JocGame.Zobrist({board:{type:"array",size:this.g.Graph.length,values:["1/0","1/1","-1/0","-1/1"]}})},Model.Game.DestroyGame=function(){},Model.Game.CheckersDirections=4,Model.Game.Checkers2WaysDirections=[0,1,1,0],Model.Game.CheckersEachDirection=function(t,s){for(var i=0;i<this.CheckersDirections;i++){var o=this.g.Graph[t][i];if(null!=o&&0==s(o,i))return}},Model.Move.Init=function(t){this.pos=[];for(var s=t.pos?Object.keys(t.pos).sort():[],i=0;i<s.length;i++)this.pos.push(t.pos[i]);this.capt=[];for(var o=t.capt?Object.keys(t.capt).sort():[],i=0;i<o.length;i++)this.capt.push(t.capt[i])},Model.Move.ToString=function(s){s=s||"natural";var i=this;switch(s){case"natural":return function(){for(var s=[t(i.pos[0]),t(i.pos[i.pos.length-1])],o="-",e=1;e<i.capt.length;e++)null!=i.capt[e]&&(o="x",i.capt.length>3&&s.push(t(i.capt[e])));return s.join(o)}();case"hub":return function(){var s="-",o=[t(i.pos[0]),t(i.pos[i.pos.length-1])];if(i.capt[1]){s="x";var e=i.capt.slice(1).map(function(s){return t(s)});e.sort(),o=o.concat(e)}return o.join(s)}();case"dxp":return function(){var s=[t(i.pos[0]),t(i.pos[i.pos.length-1])];if(i.capt[1]){s.push(i.capt.length-1);for(var o=[],e=1;e<i.capt.length;e++)o.push(t(i.capt[e]));o.sort(),s=s.concat(o)}else s.push(0);return s.map(function(t){return t<10?"0"+t:t}).join("")}();default:return"??"}},Model.Board.Init=function(t){this.zSign=0},Model.Board.InitialPosition=function(t){var s=t.mOptions.width,i=t.mOptions.height,o=t.mOptions.initial;this.board=[];for(var e=0;e<i;e++)for(var r=0;r<s;r++)this.board[e*s+r]=-1;this.pieces=[];var n=0;if(t.mInitial){this.pCount=[0,0],this.spCount=[0,0],this.kpCount=[0,0];for(var a=0;a<t.mInitial.pieces.length;a++){var h=t.mInitial.pieces[a];this.board[h.p]=a,this.pieces.push({s:h.s,p:h.p,l:-1,t:h.t,plp:h.p}),this.zSign=t.zobrist.update(this.zSign,"board",h.s+"/"+h.t,h.p);var p=-(h.s-1)/2;this.pCount[p]++,0==h.t?this.spCount[p]++:this.kpCount[p]++}}else{for(var a in o.a)if(o.a.hasOwnProperty(a)){var u=o.a[a],c=u[0]*s+u[1],h={s:JocGame.PLAYER_A,p:c,l:-1,t:0,plp:c};this.pieces.push(h),this.board[c]=n++,this.zSign=t.zobrist.update(this.zSign,"board","1/0",c)}for(var a in o.b)if(o.b.hasOwnProperty(a)){var u=o.b[a],c=u[0]*s+u[1],h={s:JocGame.PLAYER_B,p:c,l:-1,t:0,plp:c};this.pieces.push(h),this.board[c]=n++,this.zSign=t.zobrist.update(this.zSign,"board","-1/0",c)}this.pCount=[o.a.length,o.b.length],this.spCount=[o.a.length,o.b.length],this.kpCount=[o.a.length,o.b.length]}},Model.Board.GenerateMoves=function(t){try{this._GenerateMoves(t)}catch(t){}},Model.Board._GenerateMoves=function(t){function s(t){for(var s=0;s<e.pieces.length;s++){var i=e.pieces[s];i&&i.s==e.mWho&&t(s,i.p)}}function i(s,o,r,n,a){for(;;){var h=[],p=[],u=[];if(t.CheckersEachDirection(s,function(i,c){var l;0==t.g.canCaptureBackward&&(l=t.g.Coord[s][0]);var g=t.Checkers2WaysDirections[c];if(a){if(t.g.longRangeKing)for(;e.board[i]==-1||t.g.king180deg&&null!=i&&r.indexOf(i)>=0;)i=t.g.Graph[i][c];if(null!=i&&e.board[i]>=0&&e.pieces[e.board[i]].s==-e.mWho){var v=i;if(i=t.g.Graph[i][c],t.g.kingCaptureShort){if(e.board[i]==-1||i==o[0]){for(var f=!0,d=0;d<n.length;d++)if(t.g.king180deg){if(r[d]==v){f=!1;break}}else if(t.g.captureInstantRemove&&r[d]==v||0==t.g.captureInstantRemove&&r[d]==v&&n[d]==g){f=!1;break}f&&(h.push(i),p.push(v),u.push(g)),i=t.g.Graph[i][c]}}else for(;e.board[i]==-1||i==o[0]||null!==i&&t.g.captureInstantRemove&&r.indexOf(i)>=0;){for(var f=!0,d=0;d<n.length;d++)if(t.g.captureInstantRemove&&r[d]==v||0==t.g.captureInstantRemove&&r[d]==v&&n[d]==g){f=!1;break}f&&(h.push(i),p.push(v),u.push(g)),i=t.g.Graph[i][c]}}}else if(e.board[i]>=0&&e.pieces[e.board[i]].s==-e.mWho){var m,C;if(0==t.g.canCaptureBackward&&(m=t.g.Coord[i][0],C=!1,(e.mWho==JocGame.PLAYER_A&&m>=l||e.mWho==JocGame.PLAYER_B&&m<=l)&&(C=!0)),t.g.canCaptureBackward||1==C){var b=t.g.Graph[i][c];if(null!=b&&(e.board[b]==-1||b==o[0]||null!==b&&t.g.captureInstantRemove&&r.indexOf(b)>=0)){for(var f=!0,d=0;d<n.length;d++)if(t.g.captureInstantRemove&&r[d]==i||0==t.g.captureInstantRemove&&r[d]==i&&n[d]==g){f=!1;break}f&&(h.push(b),p.push(i),u.push(g))}}}return!0}),0==h.length){o.length>1&&e.mMoves.push({pos:o,capt:r});break}if(!t.g.compulsoryCatch&&o.length>1){for(var c=[],l=0;l<o.length;l++)c.push(o[l]);for(var g=[],l=0;l<r.length;l++)g.push(r[l]);e.mMoves.push({pos:c,capt:g})}if(1!=h.length){for(var l=0;l<h.length;l++){for(var c=[],v=0;v<o.length;v++)c.push(o[v]);c.push(h[l]);for(var g=[],v=0;v<r.length;v++)g.push(r[v]);g.push(p[l]);for(var f=[],v=0;v<n.length;v++)f.push(n[v]);f.push(u[l]),i(h[l],c,g,f,a)}break}s=h[0],o.push(s),r.push(p[0]),n.push(u[0])}}var o=t.mOptions.height,e=this;if(this.mMoves=[],s(function(t,s){0==e.pieces[t].t?i(s,[s],[null],[null],!1):1==e.pieces[t].t&&i(s,[s],[null],[null],!0)}),0!=t.g.compulsoryCatch&&0!=this.mMoves.length||s(function(s,i){var r;0==e.pieces[s].t?((t.g.mustMoveForward||t.g.mustMoveForwardStrict||t.lastRowFreeze)&&(r=t.g.Coord[i][0]),t.CheckersEachDirection(i,function(n,a){var h,p,u;return t.g.mustMoveForwardStrict?(h=t.g.Coord[n][0],p=!1,(e.mWho==JocGame.PLAYER_A&&h>r||e.mWho==JocGame.PLAYER_B&&h<r)&&(p=!0)):t.g.mustMoveForward&&(h=t.g.Coord[n][0],p=!0,(e.mWho==JocGame.PLAYER_A&&h<r||e.mWho==JocGame.PLAYER_B&&h>r)&&(p=!1)),t.g.lastRowFreeze&&(u=!1,(e.mWho==JocGame.PLAYER_A&&r==o-1||e.mWho==JocGame.PLAYER_B&&0==r)&&(u=!0)),e.board[n]!=-1||!t.g.canStepBack&&n==e.pieces[s].l||(0!=t.g.mustMoveForward||0!=t.g.mustMoveForwardStrict)&&1!=p||0!=t.g.lastRowFreeze&&0!=u||e.mMoves.push({pos:[i,n],capt:[null,null]}),!0})):1==e.pieces[s].t&&t.CheckersEachDirection(i,function(s,o){if(t.g.longRangeKing)for(;e.board[s]==-1;)e.mMoves.push({pos:[i,s],capt:[null,null]}),s=t.g.Graph[s][o];else e.board[s]==-1&&(e.mMoves.push({pos:[i,s],capt:[null,null]}),s=t.g.Graph[s][o]);return!0})}),0==this.mMoves.length)switch(t.g.noMove){case"count":this.mFinished=!0,this.pCount[0]<this.pCount[1]?this.mWinner=JocGame.PLAYER_B:this.pCount[1]<this.pCount[0]?this.mWinner=JocGame.PLAYER_A:this.mWinner=JocGame.DRAW;break;case"lose":this.mFinished=!0,this.mWinner=-this.mWho;break;default:this.mFinished=!0,this.mWinner=JocGame.DRAW}if(t.g.captureLongestLine){for(var r=this.mMoves,n=[],a=0,h=0;h<r.length;h++){var p=r[h];p.pos.length==a?n.push(p):p.pos.length>a&&(n=[p],a=p.pos.length)}this.mMoves=n}},Model.Board.Evaluate=function(t,s,i){if(t.mOptions.preventRepeat&&t.GetRepeatOccurence(this)>2)return this.mFinished=!0,void(this.mWinner=JocGame.DRAW);if(t.g.drawKvsK&&0==this.spCount[0]&&0==this.spCount[1]&&1==this.kpCount[0]&&1==this.kpCount[1])return this.mFinished=!0,void(this.mWinner=JocGame.DRAW);if(t.g.drawKvs2K&&0==this.spCount[0]&&0==this.spCount[1]&&this.kpCount[0]+this.kpCount[1]==3&&(1==this.kpCount[0]||2==this.kpCount[0]))return this.mFinished=!0,void(this.mWinner=JocGame.DRAW);if(0==this.pCount[1])return this.mFinished=!0,void(this.mWinner=JocGame.PLAYER_A);if(0==this.pCount[0])return this.mFinished=!0,void(this.mWinner=JocGame.PLAYER_B);if(this.mEvaluation=10*(this.spCount[0]-this.spCount[1])+10*(this.kpCount[0]-this.kpCount[1])*t.g.kingValue+this.pCount[0]/this.pCount[1]-this.pCount[1]/this.pCount[0],0!=t.g.lastRowFactor){for(var o=t.mOptions.height,e=0,r=0,n=0;n<this.pieces.length;n++){var a=this.pieces[n];a&&0==a.t&&(this.mWho==JocGame.PLAYER_A?e+=t.g.Coord[a.p][0]:r+=o-1-t.g.Coord[a.p][0])}this.mEvaluation+=(e-r)*t.g.lastRowFactor}},Model.Board.CopyFrom=function(t){this.board=[];for(var s=0;s<t.board.length;s++)this.board[s]=t.board[s];this.pieces=[];for(var s=0;s<t.pieces.length;s++){var i=t.pieces[s];this.pieces[s]=null==i?null:{s:i.s,p:i.p,l:i.l,t:i.t,plp:i.plp}}this.pCount=[t.pCount[0],t.pCount[1]],this.spCount=[t.spCount[0],t.spCount[1]],this.kpCount=[t.kpCount[0],t.kpCount[1]],this.mWho=t.mWho,this.zSign=t.zSign},Model.Board.ApplyMove=function(t,s){var i=(t.mOptions.width,t.mOptions.height),o=s.pos[0],e=this.board[o],r=this.pieces[e],n=r.s;r.l=o;var a={};this.zSign=t.zobrist.update(this.zSign,"board",r.s+"/"+r.t,r.p);for(var h=1;h<s.pos.length;h++){var p=s.pos[h];this.board[r.p]=-1,r.p=p,this.board[p]=e;var u=s.capt[h];null!=u&&(this.board[u]>=0&&(a[this.board[u]]=!0),this.board[u]=-1),o=p}this.zSign=t.zobrist.update(this.zSign,"board",r.s+"/"+r.t,p);var c=s.capt[s.capt.length-1];r.plp=c||s.pos[s.pos.length-2];for(var l in a)if(a.hasOwnProperty(l)){var g=this.pieces[l],v=(1-g.s)/2;switch(this.pCount[v]--,g.t){case 0:this.spCount[v]--;break;case 1:this.kpCount[v]--}this.zSign=t.zobrist.update(this.zSign,"board",g.s+"/"+g.t,g.p),this.pieces[l]=null}if(t.g.lastRowCrown&&0==this.pieces[e].t){var f=t.g.Coord[s.pos[s.pos.length-1]][0];if(n==JocGame.PLAYER_A&&f==i-1||n==JocGame.PLAYER_B&&0==f){var g=this.pieces[e];g.t=1;var d=(1-n)/2;this.spCount[d]--,this.kpCount[d]++,this.zSign=t.zobrist.update(this.zSign,"board",g.s+"/0",g.p),this.zSign=t.zobrist.update(this.zSign,"board",g.s+"/1",g.p)}}},Model.Board.IsValidMove=function(t,s){return!0},Model.Board.GetSignature=function(){return this.zSign},Model.Game.Import=function(t,s){function i(t,s,i){i=r-i;var o=i%n;i=i-o+n-o-1,e.push({s:t,p:i,l:-1,t:s,plp:i})}var o=1,e=[],r=this.mOptions.width*this.mOptions.height,n=this.mOptions.width;if("pjn"==t){var a=s.split(":");o="W"==a[0]?1:-1;for(var h=1;h<a.length;h++)if(0!=a[h].length)for(var p="W"==a[h].substr(0,1)?1:-1,u=a[h].substr(1).split(","),c=0;c<u.length;c++){var l=u[c],g=0;"K"==l.substr(0,1)&&(g=1,l=l.substr(1));var v=/^([0-9]+)-([0-9]+)$/.exec(l);if(v)for(var f=parseInt(v[1]);f<=parseInt(v[2]);f++)i(p,g,f);else i(p,g,parseInt(l))}return e.sort(function(t,s){return s.s-t.s}),{status:!0,initial:{pieces:e,turn:o}}}return{status:!1,error:"unsupported"}};var e=JocGame.prototype.GetBestMatchingMove;Model.Game.GetBestMatchingMove=function(t,s){var i=[],o=this;s.forEach(function(t){"function"==typeof t.ToString?i.push(t.ToString()):i.push(o.CreateMove(t).ToString())}),t=t.replace(/0([1-9])/g,"$1");var r=/^([0-9]+)[\-x]([0-9]+)([\-x][0-9]+)*$/.exec(t);if(r){var n=new RegExp("^"+r[1]+"[-x]"+r[2]+"([-x][0-9]+)*$"),a={};s.forEach(function(t,s){if(n.test(i[s])){var o=i[s],e=/^([0-9]+)x([0-9]+)x([0-9]+(x[0-9]+)*)/.exec(o);if(e){var r=e[3].split("x");r.sort(function(t,s){return parseInt(t)-parseInt(s)}),o=e[1]+"x"+e[2]+"x"+r.join("x")}a[o]=t}});var h=[];for(var p in a)a.hasOwnProperty(p)&&h.push(a[p]);h.length>0&&(s=h)}return e.call(this,t,s)},Model.Board.ExportBoardState=function(o,e){function r(t){for(var o=[],e=0;e<n.board.length;e++){var r=e%s,a=(e-r)/s,h=(i-a-1)*s+r,p=n.board[e];if(p<0)o[h]="e";else{var u=n.pieces[p],c=1==u.s?"w":t;1==u.t&&(c=c.toUpperCase()),o[h]=c}}return o.join("")}e=e||"natural";var n=this;switch(e){case"natural":case"fen":return function(){var s={},i=[];n.pieces.forEach(function(i){if(i&&null!=i.p){var o=1==i.s?"W":"B";void 0===s[o]&&(s[o]={});var e=1==i.t?"K":"";void 0===s[o][e]&&(s[o][e]={group:0==i.t,pos:[]}),s[o][e].pos.push(parseInt(t(i.p)))}});for(var o in s)if(s.hasOwnProperty(o)){var e=[];for(var r in s[o])if(s[o].hasOwnProperty(r)){var a=s[o][r];if(a.group){a.pos.sort(function(t,s){return parseInt(t)-parseInt(s)});var h=-2,p=-1,u=-1;a.pos.forEach(function(t){parseInt(t)==h+1?p=t:(p>=0?(e.push(r+u+"-"+p),p=-1):u>=0&&e.push(r+u),u=t),h=parseInt(t)}),p>=0?e.push(r+u+"-"+p):u>=0&&e.push(r+u)}else a.pos.forEach(function(t){e.push(r+t)})}i.push(o+e.join(","))}return i.join(":")}();case"dxp":return function(){return r("z")}();case"hub":return function(){return r("z")}();default:return JSON.stringify(this)}}}(),Model.Game.BuildGraphCoord=function(){for(var t=this.mOptions.width,s=this.mOptions.height,i=[],o=[],e=0;e<s;e++)for(var r=0;r<t;r++){var n=e*t+r;o[n]=[e,r],i[n]=[],e%2==0?(e<s-1?(i[n].push((e+1)*t+r),r>0?i[n].push((e+1)*t+r-1):i[n].push(null)):(i[n].push(null),i[n].push(null)),e>0?(i[n].push((e-1)*t+r),r>0?i[n].push((e-1)*t+r-1):i[n].push(null)):(i[n].push(null),i[n].push(null))):(e<s-1?(r<t-1?i[n].push((e+1)*t+r+1):i[n].push(null),i[n].push((e+1)*t+r)):(i[n].push(null),i[n].push(null)),e>0?(r<t-1?i[n].push((e-1)*t+r+1):i[n].push(null),i[n].push((e-1)*t+r)):(i[n].push(null),i[n].push(null)))}this.g.Graph=i,this.g.Coord=o};